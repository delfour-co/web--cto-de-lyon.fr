<header
  class="header {{ if site.Params.navbar_fixed }}sticky top-0{{ end }} z-30">
  <nav class="navbar container">
    <div class="order-0">
      <a class="navbar-brand block" href="{{ site.Home.RelPermalink }}">
        {{ partial "logo" }}
      </a>
    </div>
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      class="order-3 cursor-pointer flex items-center lg:hidden text-text-dark dark:text-white lg:order-1">
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>

    <div
      id="nav-menu"
      class="order-3 hidden lg:flex lg:flex-col lg:items-center lg:gap-0 lg:order-1 lg:w-auto">
      {{ $currentPage := . }}
      {{ $mainMenu := site.Menus.main }}

      <!-- Mobile : liste verticale unique -->
      <ul class="navbar-nav flex flex-col w-full pb-6 lg:hidden lg:pb-0 lg:space-x-2 xl:space-x-8">
        {{ range $mainMenu }}
          {{ $menuURL := .URL | absLangURL }}
          {{ $pageURL:= $currentPage.Permalink | absLangURL }}
          {{ $active := eq $menuURL $pageURL }}
          {{ if .HasChildren }}
            <li class="nav-item nav-dropdown group relative">
              <input
                type="checkbox"
                id="submenu-{{ .Name | urlize }}"
                class="peer hidden lg:hidden" />
              <label
                for="submenu-{{ .Name | urlize }}"
                class="nav-link inline-flex items-center">
                {{ .Name }}
                <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20">
                  <path
                    d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                </svg>
              </label>
              <ul
                class="nav-dropdown-list hidden peer-checked:block lg:invisible lg:absolute lg:block lg:opacity-0 lg:group-hover:visible lg:group-hover:opacity-100">
                {{ range .Children }}
                  {{ $childURL := .URL | absLangURL }}
                  {{ $active := eq $childURL $pageURL }}
                  <li class="nav-dropdown-item">
                    <a
                      class="nav-dropdown-link {{ if $active }}active{{- end -}}"
                      {{ if findRE `^http` .URL }}
                        target="_blank" rel="noopener"
                      {{ end }}
                      href="{{- if findRE `^#` .URL -}}
                        {{- if not $.IsHome -}}
                          {{- site.Home.RelPermalink -}}
                        {{- end }}
                        {{- .URL -}}
                      {{- else -}}
                        {{- .URL | relLangURL -}}
                      {{- end -}}">
                      {{ .Name }}
                    </a>
                  </li>
                {{ end }}
              </ul>
            </li>
          {{ else }}
            <li class="nav-item">
              <a
                class="nav-link {{ if $active }}active{{- end -}}"
                {{ if findRE `^http` .URL }}
                  target="_blank" rel="noopener"
                {{ end }}
                href="{{- if findRE `^#` .URL -}}
                  {{- if not $.IsHome -}}
                    {{- site.Home.RelPermalink -}}
                  {{- end }}{{- .URL -}}
                {{- else -}}
                  {{- .URL | relLangURL -}}
                {{- end -}}"
                >{{ .Name }}</a
              >
            </li>
          {{ end }}
        {{ end }}
        {{ if site.Params.navigation_button.enable }}
          <li class="mt-4 inline-block lg:hidden">
            <a
              class="btn btn-outline-primary btn-sm"
              href="{{ site.Params.navigation_button.link | relLangURL }}"
              {{ if (hasPrefix site.Params.navigation_button.link `http`) }}
                target="_blank" rel="noopener"
              {{ end }}>
              {{ site.Params.navigation_button.label }}
            </a>
          </li>
        {{ end }}
      </ul>

      <!-- Desktop : une seule ligne -->
      <ul class="navbar-nav hidden lg:flex flex-row flex-nowrap justify-center gap-x-2 xl:gap-x-4">
        {{ range $mainMenu }}
          {{ $menuURL := .URL | absLangURL }}
          {{ $pageURL:= $currentPage.Permalink | absLangURL }}
          {{ $active := eq $menuURL $pageURL }}
          {{ if .HasChildren }}
            <li class="nav-item nav-dropdown group relative">
              <input
                type="checkbox"
                id="submenu-dt-{{ .Name | urlize }}"
                class="peer hidden" />
              <label
                for="submenu-dt-{{ .Name | urlize }}"
                class="nav-link inline-flex items-center">
                {{ .Name }}
                <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20">
                  <path
                    d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                </svg>
              </label>
              <ul
                class="nav-dropdown-list hidden peer-checked:block lg:invisible lg:absolute lg:block lg:opacity-0 lg:group-hover:visible lg:group-hover:opacity-100">
                {{ range .Children }}
                  {{ $childURL := .URL | absLangURL }}
                  {{ $active := eq $childURL $pageURL }}
                  <li class="nav-dropdown-item">
                    <a
                      class="nav-dropdown-link {{ if $active }}active{{- end -}}"
                      {{ if findRE `^http` .URL }}
                        target="_blank" rel="noopener"
                      {{ end }}
                      href="{{- if findRE `^#` .URL -}}
                        {{- if not $.IsHome -}}
                          {{- site.Home.RelPermalink -}}
                        {{- end }}
                        {{- .URL -}}
                      {{- else -}}
                        {{- .URL | relLangURL -}}
                      {{- end -}}">
                      {{ .Name }}
                    </a>
                  </li>
                {{ end }}
              </ul>
            </li>
          {{ else }}
            <li class="nav-item">
              <a
                class="nav-link {{ if $active }}active{{- end -}}"
                {{ if findRE `^http` .URL }}
                  target="_blank" rel="noopener"
                {{ end }}
                href="{{- if findRE `^#` .URL -}}
                  {{- if not $.IsHome -}}
                    {{- site.Home.RelPermalink -}}
                  {{- end }}{{- .URL -}}
                {{- else -}}
                  {{- .URL | relLangURL -}}
                {{- end -}}"
                >{{ .Name }}</a
              >
            </li>
          {{ end }}
        {{ end }}
      </ul>
    </div>

    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">
      <button
        id="accessibility-toggle-desktop"
        class="mr-5 p-2 rounded-full text-text-dark dark:text-darkmode-text-dark hover:bg-light dark:hover:bg-darkmode-light transition-colors focus:outline-none focus:ring-2 focus:ring-primary"
        aria-label="Ouvrir les paramètres d'accessibilité"
        aria-expanded="false"
        aria-controls="accessibility-overlay"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
        </svg>
      </button>
      {{ partial "components/theme-switcher" (dict "Class" "mr-5") }}

      {{ if site.Params.navigation_button.enable }}
        <a
          href="{{ site.Params.navigation_button.link | relLangURL }}"
          class="btn btn-outline-primary btn-sm hidden lg:inline-block"
          {{ if (hasPrefix site.Params.navigation_button.link `http`) }}target="_blank" rel="noopener"{{ end }}>
          {{ site.Params.navigation_button.label }}
        </a>
      {{ end }}
    </div>
  </nav>
</header>
