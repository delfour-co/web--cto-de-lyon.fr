---
---

<button
  id="theme-toggle"
  class="bg-gray-700 hover:bg-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 bg-gray-200 hover:bg-gray-300 text-gray-900 dark:text-white rounded-full p-2.5 shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 focus:ring-offset-gray-900 dark:focus:ring-offset-gray-900 focus:ring-offset-white"
  aria-label="Basculer entre le thème clair et sombre"
  type="button"
>
  <!-- Icône soleil (mode dark) -->
  <svg
    id="theme-toggle-light-icon"
    class="w-5 h-5 hidden dark:block"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
    ></path>
  </svg>
  <!-- Icône lune (mode light) -->
  <svg
    id="theme-toggle-dark-icon"
    class="w-5 h-5 block dark:hidden"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
    ></path>
  </svg>
</button>

<script is:inline>
  (function() {
    const THEME_STORAGE_KEY = 'theme_preference';
    const THEME_DARK = 'dark';
    const THEME_LIGHT = 'light';

    /**
     * Applique le thème au document
     */
    function applyTheme(theme) {
      const root = document.documentElement;
      
      if (theme === THEME_DARK) {
        root.classList.add(THEME_DARK);
        root.classList.remove(THEME_LIGHT);
      } else {
        root.classList.remove(THEME_DARK);
        root.classList.add(THEME_LIGHT);
      }
      
      // Sauvegarder la préférence
      localStorage.setItem(THEME_STORAGE_KEY, theme);
    }

    /**
     * Récupère le thème depuis localStorage ou les préférences système
     */
    function getTheme() {
      const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
      
      if (savedTheme) {
        return savedTheme;
      }
      
      // Utiliser les préférences système si disponibles
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return THEME_DARK;
      }
      
      // Par défaut, garder le dark (comme actuellement)
      return THEME_DARK;
    }

    /**
     * Initialise le toggle de thème
     */
    function initThemeToggle() {
      const toggleBtn = document.getElementById('theme-toggle');
      
      if (!toggleBtn) {
        return;
      }

      // Appliquer le thème au chargement
      const currentTheme = getTheme();
      applyTheme(currentTheme);

      // Gérer le clic sur le bouton
      toggleBtn.addEventListener('click', () => {
        const currentTheme = getTheme();
        const newTheme = currentTheme === THEME_DARK ? THEME_LIGHT : THEME_DARK;
        applyTheme(newTheme);
      });

      // Écouter les changements de préférences système
      if (window.matchMedia) {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', (e) => {
          // Seulement si l'utilisateur n'a pas de préférence sauvegardée
          if (!localStorage.getItem(THEME_STORAGE_KEY)) {
            applyTheme(e.matches ? THEME_DARK : THEME_LIGHT);
          }
        });
      }
    }

    // Initialiser immédiatement pour éviter le flash
    const theme = getTheme();
    if (theme === THEME_DARK) {
      document.documentElement.classList.add(THEME_DARK);
    } else {
      document.documentElement.classList.remove(THEME_DARK);
      document.documentElement.classList.add(THEME_LIGHT);
    }

    // Initialiser le toggle après le chargement du DOM
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initThemeToggle);
    } else {
      initThemeToggle();
    }
  })();
</script>
